/*! aml v1.0.0 xdf email:xudafeng[at]126.com 2013-10-12 19:20:14 */
!function(a){"use strict";function b(){function a(a,b){for(var c in b)a[c]=b[c];return a}for(var b,c=0;c<arguments.length;)b=c?a(b,arguments[c]):arguments[c],c++;return b}function c(a,b){if(a)for(var c in a)"length"!==c&&"item"!==c&&b.call(this,a[c],c);return a}function d(){return w++}function e(a){return function(b){return Object.prototype.toString.call(b)==="[object "+a+"]"}}function f(a){return function(b){return"array"==a||"string"==a?0===b.length:void 0}}function g(){}function h(){}function i(){var a=v.path?v.path:r.href;return a}function j(a,b){this.id=a,this.callback=b,this.pwd=i(),this.init()}function k(a){var b=a.toString(),c=/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|\/\*[\S\s]*?\*\/|\/(?:\\\/|[^\/\r\n])+\/(?=[^\/])|\/\/.*|\.\s*require|(?:^|[^$])\brequire\s*\(\s*(["'])(.+?)\1\s*\)/g,d=/\\\\/g,e=[];return b.replace(d,"").replace(c,function(a,b,c){c&&e.push(c)}),e}function l(){}function m(){var a=q.getElementsByTagName("script");return a[a.length-1].getAttribute("data-init")}if(!a.aml){var n="1.0.0",o="",p=document.head||document.getElementsByTagName("head")[0]||document.documentElement,q=document,r=location,s=".js",t={version:n},u=t.data={},v={},w=0,x=e("String"),y=e("Array");e("Object"),e("Function");var z=e("Undefined"),A=f("array");f("string");var B=function(a){return/\.js$/i.test(a)},C=function(a){return/\.css$/i.test(a)};g.cache={},b(g,{fire:function(a,b){z(this.cache[a])||this.cache[a].call(this,b)},on:function(a,b){this.cache[a]=b},detach:function(a){z(this.cache[a])||delete this.cache[a]}}),b(h,{}),j.prototype={init:function(){this.router()},router:function(){var a=this;C(a.id)?a.getStyle(this.pwd+a.id):a.getScript((B(a.id)?a.id:this.pwd+a.id+s)+"?t="+(v.tag?v.tag:(new Date).valueOf()),a.callback)},getScript:function(a,b,c){var d=q.createElement("script");return d.src=a,d.async=!0,c&&(d.charset=c),q.addEventListener?d.addEventListener("load",b,!1):d.onreadystatechange=function(){("loaded"==d.readyState||"complete"==d.readyState)&&(d.onreadystatechange=null,b&&b())},p.insertBefore(d,p.firstChild),d},getStyle:function(a,b,c){var d=q.createElement("link");return d.rel="stylesheet",d.href=a,c&&(d.charset=c),d.addEventListener("load",b,!1),p.appendChild(d),d}};var D={},E=[];u.exports={constructor:function(){return D},deps:[],id:"exports"},b(l,{define:function(a,b,c){var e=a,f=b,h=c;switch(arguments.length){case 1:e=A(E)?"anony"+d():E.pop(),f=[],h=a;break;case 2:x(e)?(f=[],h=b):y(e)&&(e=A(E)?"anony"+d():E.pop(),f=a,h=b)}for(var i=k(h),j=0;j<i.length;j++)E.push(i[j]),f.push(i[j]);g.fire("define",{id:e,deps:f,constructor:h})},require:function(a){return u[a].exports},exec:function(a){u[a.id].instance=u[a.id].constructor.apply(this,a.depsMods)||{},u[a.id].exports=D,g.fire("check",u)},load:function(a,b){new j(a,b)},save:function(a){u[a.id]&&u[a.id]!=a.id||(u[a.id]=a,g.fire("check",u))},check:function(a){c(a,function(a){if(!a.instance&&a!=u[a]){var b=[],d=[],e=[];c(a.deps,function(a){u[a]?u[a].instance?d.push(u[a].instance):b.push(u[a]):(e.push(a),u[a]=a)}),A(e)&&A(b)?g.fire("exec",{id:a.id,depsMods:d}):(c(e,function(a){g.fire("load",a)}),g.fire("check",b))}})},preLoad:function(){}}),g.on("define",function(a){g.fire("save",a)}),g.on("check",function(a){l.check(a)}),g.on("exec",function(a){l.exec(a)}),g.on("load",function(a){l.load(a)}),g.on("save",function(a){l.save(a)}),g.on("require",function(a){l.load(a.id,a.callback)}),l.define.amd={},a.define=l.define,a.require=l.require,m()&&new j(m()+(B(m())?o:s)),b(t,{config:function(a){b(v,a)}}),a.aml=t}}(this);
